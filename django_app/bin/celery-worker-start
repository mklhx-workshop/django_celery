#!bin/bash

# while [curl -sf http://broker:5672/ 2>&1 | grep '52' ]
# do
#   sleep 1
# done
is_running=$(celery -A django_celery status | grep -c "OK")
if [[ is_running -ne 1 ]]; then
    echo "starting celery worker..."
    celery -A django_celery worker -E --detach --pidfile="" -l INFO -f logs/celery/celery-worker.log --without-heartbeat --without-gossip --without-mingle --pool=solo --concurrency=1
    echo "celery worker started"
else
    echo "celery worker already started!"
fi